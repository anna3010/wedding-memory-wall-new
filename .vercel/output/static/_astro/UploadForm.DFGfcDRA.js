import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DYrVU9rO.js";const V=()=>{const[r,u]=i.useState({guestName:"",message:"",files:[]}),[h,b]=i.useState(!1),[f,x]=i.useState(""),[l,c]=i.useState({}),[w,M]=i.useState(!1),[A,S]=i.useState(!1),[F,O]=i.useState(0),[y,k]=i.useState(null),N=i.useRef(null);i.useRef([]),i.useRef(null),i.useRef(null);const j=i.useRef(null),E=t=>{if(!["image/jpeg","image/png","image/gif","image/webp","audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/webm","audio/webm;codecs=opus","video/mp4","video/webm","video/quicktime","video/x-msvideo"].includes(t.type))return"Please upload an image (JPG, PNG, GIF, WebP), audio file (MP3, WAV, OGG, M4A, WebM), or video file (MP4, WebM, MOV, AVI)";const n=t.type.startsWith("video/")?15728640:10*1024*1024;return t.size>n?`File size must be less than ${t.type.startsWith("video/")?"15MB":"10MB"}`:null},p=t=>{const{name:s,value:a,files:n}=t.target;if(s==="files"){const o={},d=Array.from(n);d.forEach((m,g)=>{const v=E(m);v&&(o[`file${g}`]=v)}),c(m=>({...m,...o})),u(m=>({...m,files:[...m.files,...d],type:d.length>0&&d[0].type.startsWith("audio/")?"audio":d[0].type.startsWith("video/")?"video":"image"}))}else u(o=>({...o,[s]:a})),l[s]&&c(o=>({...o,[s]:""}))},W=async t=>{t.preventDefault();const s={};if(r.guestName.trim()||(s.guestName="Name is required"),r.message.trim()||(s.message="Message is required"),(!r.files||r.files.length===0)&&(s.file="Please select at least one file"),Object.keys(s).length>0){c(s);return}b(!0),x(""),c({});try{const a=new FormData;a.append("guestName",r.guestName),a.append("message",r.message),r.files.forEach(d=>{a.append("files",d)});const n=await fetch("/api/upload",{method:"POST",body:a});if(!n.ok)throw new Error("Upload failed");const o=await n.json();if(o.success){const d=JSON.parse(sessionStorage.getItem("weddingMemories")||"[]"),m=Array.isArray(o.data)?o.data:[o.data],g=[...m,...d];console.log("ðŸ’¾ Saving to session storage:",{currentCount:d.length,newMemories:m,updatedCount:g.length}),sessionStorage.setItem("weddingMemories",JSON.stringify(g)),x(`${m.length} memory(ies) uploaded successfully! ðŸŽ‰`),u({guestName:"",message:"",files:[]})}else throw new Error(o.message||"Upload failed");document.getElementById("files").value=""}catch(a){x("Sorry, something went wrong. Please try again."),console.error("Upload error:",a)}finally{b(!1)}},I=r.guestName.trim()&&r.message.trim()&&r.files&&r.files.length>0&&!Object.values(l).some(t=>t),C=t=>{u(s=>({...s,files:s.files.filter((a,n)=>n!==t)})),c(s=>{const a={...s};return delete a.file,Object.keys(a).forEach(n=>{n.startsWith("file")&&delete a[n]}),a})},P=()=>{N.current&&w&&(N.current.stop(),M(!1),j.current&&clearInterval(j.current))},R=()=>{y&&(y.getTracks().forEach(t=>t.stop()),k(null),S(!1))};return i.useEffect(()=>()=>{P(),R()},[]),e.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-md p-4 sm:p-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6",children:"Share Your Memory"}),f&&e.jsx("div",{className:`mb-4 p-3 sm:p-4 border rounded-md ${f.includes("successfully")?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsx("p",{className:`${f.includes("successfully")?"text-green-800":"text-red-800"} text-sm sm:text-base`,children:f})}),e.jsxs("form",{onSubmit:W,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"guestName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Name *"}),e.jsx("input",{type:"text",id:"guestName",name:"guestName",value:r.guestName,onChange:p,required:!0,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm sm:text-base ${l.guestName?"border-red-500":"border-gray-300"}`,placeholder:"Enter your name"}),l.guestName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.guestName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Message *"}),e.jsx("textarea",{id:"message",name:"message",value:r.message,onChange:p,required:!0,rows:4,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm sm:text-base ${l.message?"border-red-500":"border-gray-300"}`,placeholder:"Share your wedding wishes, memories, or thoughts..."}),l.message&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Media *"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"file",id:"files",name:"files",multiple:!0,onChange:p,required:r.files.length===0,accept:"image/*,audio/*,video/*",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100 ${l.file?"border-red-500":"border-gray-300"}`})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Upload files from your device - Supported formats: Images (JPG, PNG, GIF, WebP), Audio (MP3, WAV, OGG, M4A), and Videos (MP4, WebM, MOV, AVI) - Max size: 10MB for images/audio, 15MB for videos"}),l.file&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.file})]}),r.files&&r.files.length>0&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected ",r.files.length," file(s):"]}),r.files.length>0&&e.jsx("button",{type:"button",onClick:()=>{u(t=>({...t,files:[]})),c(t=>{const s={...t};return delete s.file,Object.keys(s).forEach(a=>{a.startsWith("file")&&delete s[a]}),s})},className:"text-xs text-red-600 hover:text-red-800 font-medium",children:"Clear All"})]}),e.jsx("ul",{className:"space-y-2",children:r.files.map((t,s)=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-white rounded border border-gray-200",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["(",(t.size/1024/1024).toFixed(2)," MB)"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.type.startsWith("audio/")?"ðŸŽ¤ Audio":t.type.startsWith("video/")?"ðŸŽ¥ Video":"ðŸ“· Image"})]})]}),e.jsx("button",{type:"button",onClick:()=>C(s),className:"ml-2 p-1.5 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors",title:"Remove file",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s))})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!I||h,className:"w-full bg-pink-600 text-white py-2 px-4 rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200",children:h?"Uploading...":"Share Memory"})})]})]})};export{V as default};
